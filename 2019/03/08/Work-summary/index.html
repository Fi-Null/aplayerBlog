<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#CC543A">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.1">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico?v=7.4.1">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico?v=7.4.1">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.1" color="#CC543A">

<link rel="stylesheet" href="/css/main.css?v=7.4.1">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.4.1',
    exturl: false,
    sidebar: {"position":"left","width":240,"display":"post","offset":12,"onmobile":true},
    copycode: {"enable":true,"show_result":true,"style":"flat"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#CC543A","save":"auto"},
    fancybox: true,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="订单中心：简介：负责生成订单，把控整个订单生命周期（支付完成-&gt;补全-》下发商家-〉妥投等流程），通知下游系统订单状态变更，订单查询服务。现状：接手之前，COE频发。每年至少出3-4次事故，给平台造成巨大的经济损失，用户流失。力保系统必须稳定，我们的订单时效是一小时，高峰期一旦系统出问题造成订单无法生产，在1个小时内是解决不了的，压力很大。">
<meta property="og:type" content="article">
<meta property="og:title" content="Work summary">
<meta property="og:url" content="https://fi-null.github.io/2019/03/08/Work-summary/index.html">
<meta property="og:site_name" content="Xk&#39;s | Blog">
<meta property="og:description" content="订单中心：简介：负责生成订单，把控整个订单生命周期（支付完成-&gt;补全-》下发商家-〉妥投等流程），通知下游系统订单状态变更，订单查询服务。现状：接手之前，COE频发。每年至少出3-4次事故，给平台造成巨大的经济损失，用户流失。力保系统必须稳定，我们的订单时效是一小时，高峰期一旦系统出问题造成订单无法生产，在1个小时内是解决不了的，压力很大。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2019-03-08T15:32:45.000Z">
<meta property="article:modified_time" content="2020-04-01T13:13:04.912Z">
<meta property="article:author" content="Ke Xiang">
<meta name="twitter:card" content="summary">
  <link rel="canonical" href="https://fi-null.github.io/2019/03/08/Work-summary/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Work summary | Xk's | Blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- MetingJS start -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
  <script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/meting@1.2.0/dist/Meting.min.js"></script>
  <!-- MetingJS end -->
<script>
  (function(d) {
    var config = {
      kitId: 'tzu7ura',
      scriptTimeout: 3000,
      async: true
    },
    h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
  })(document);
</script>

  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xk's | Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">Stay Hungry, Stay Foolish</h1>
      
    <!--
    -->
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resume">

    <a href="https://fi-null.github.io/resumeWeb" target="_blank" rel="section"><i class="fa fa-fw fa-handshake-o"></i>简历</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fi-null.github.io/2019/03/08/Work-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Ke Xiang">
      <meta itemprop="description" content="Do more, Know more, Be more">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xk's | Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          Work summary
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-08 23:32:45" itemprop="dateCreated datePublished" datetime="2019-03-08T23:32:45+08:00">2019-03-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/summary/" itemprop="url" rel="index">
                    <span itemprop="name">summary</span>
                  </a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="订单中心："><a href="#订单中心：" class="headerlink" title="订单中心："></a>订单中心：</h2><h3 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h3><p>负责生成订单，把控整个订单生命周期（支付完成-&gt;补全-》下发商家-〉妥投等流程），通知下游系统订单状态变更，订单查询服务。</p><h3 id="现状："><a href="#现状：" class="headerlink" title="现状："></a>现状：</h3><p>接手之前，COE频发。每年至少出3-4次事故，给平台造成巨大的经济损失，用户流失。</p><p>力保系统必须稳定，我们的订单时效是一小时，高峰期一旦系统出问题造成订单无法生产，在1个小时内是解决不了的，压力很大。</p><a id="more"></a>


<p>观察以往事故经验，出事故主要集中在Es查询服务这边，查询超时，商家查不到订单，无法生成。</p>
<p>排查Es查询服务，发现Es集群服务器Cpu经常抖动，cpu使用使用率飙高到90%，于是查询原因：（1）Es集群混布，其他系统的es集群也不部署在订单中心查询服务器上，高峰期存在资源抢占，分配不均等行为。（2）Es单集群，存储到家3年的订单，大概10几亿条数据，数据量大，订单的复杂查询（比如多条件聚合查询）多，聚合查询每分钟能达到500k。</p>
<h3 id="技术架构升级优化："><a href="#技术架构升级优化：" class="headerlink" title="技术架构升级优化："></a>技术架构升级优化：</h3><p>（1）单独搭建一套新的Es热集群，集群资源不与任何系统共享，消除混布带来的不稳定。并且热集群只保存5天的数据，大概500万左右。思考我们的业务，其实99%的订单都会在一小时内送出去，热集群保存5天数据用于生产环境的查询完全是没有任何问题。如果商家有查询历史数据的需求，可以继续查原来的冷集群全量数据。</p>
<p>（2）冷热双集群问题不仅解决了之前的查询问题。还解决了之前的单点故障，如果Es热集群挂了，可以立马切换到冷集群。之前数据是双写的，冷集群数据好似全量数据。热双集群实时可以随时切换。</p>
<p>升级订单中心Es单集群架构为冷热双集群架构，不仅解决集群单点故障，还解决订单数据查询和存储瓶颈等问题，使订单中心处理订单处理能力由日均百万级单量升级为千万级。</p>
<h3 id="业务升级："><a href="#业务升级：" class="headerlink" title="业务升级："></a>业务升级：</h3><h4 id="成果："><a href="#成果：" class="headerlink" title="成果："></a>成果：</h4><p>开发到家配送联盟，使订单的履约率有96.5%提升到99.5%。配送联盟是去年参加<strong>hackthon</strong>的idea，并且深受各位评委的好评，夺得<strong>hackthon</strong>一等奖，并且也获得了去年的公司最佳项目一等奖。 </p>
<h4 id="背景（why）："><a href="#背景（why）：" class="headerlink" title="背景（why）："></a>背景（why）：</h4><p>观察数据，发现到家配送履约率只有96.5%，100单就有4单没有配送。分析其原因：配送只有达达一方，有些地方达达运力覆盖不足，导致无人配送。于是萌生出到家配送联盟的idea。订单抛给达达，达达在X（可配置）分钟内未接单，同时抛单给美团、顺丰、点我达、闪送。</p>
<h4 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h4><p>hackthon获奖后，一人独自开发完整的到家配送联盟系统，一周之内对接完所有的三方配送并且上线。并且之后对业务做了一些优化。（1）高价值的数码订单交给顺丰、闪送。（2）按时段抛单，每个时段的抛单时间不对。（医药订单的夜间配送直接抛给美团。）</p>
<h4 id="后续对配送联盟的下一步思考："><a href="#后续对配送联盟的下一步思考：" class="headerlink" title="后续对配送联盟的下一步思考："></a>后续对配送联盟的下一步思考：</h4><p>抛单策略比较粗暴。需要一个抛单策略算法，由算法综合各个因需（ 各个配送运力情况，配送完成率，每单成本【0-3公里 美团便宜；3公里以上，点我达便宜】等）评估，最终做到最适合抛单的配送。</p>
<h2 id="商家中心"><a href="#商家中心" class="headerlink" title="商家中心"></a>商家中心</h2><h3 id="简介：-1"><a href="#简介：-1" class="headerlink" title="简介："></a>简介：</h3><p>对接开放平台  对接商家，提供商家各种操作订单的能力（接单-》打印-》捡货-〉配送-》妥投，异常流程）。</p>
<h3 id="技术优化："><a href="#技术优化：" class="headerlink" title="技术优化："></a>技术优化：</h3><h4 id="现象："><a href="#现象：" class="headerlink" title="现象："></a>现象：</h4><p>Young Gc慢，一次Young Gc达到了夸张的4000ms。造成很多对外提供的的接口响应时间超时，所有接口的 tp 999都超过了4s，对商家的生产造成了很大的影响。</p>
<h4 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h4><p>常规方法：打印Gc日志，并分析Gc日志。但是观察Gc日志，Young gc的详细过程【1、级联扫描Young区根对象。2、扫描卡表时间。3、扫描根直接在old区的根对象】并没有，无法查明具体原因。通过查阅资料和观察，发现young gc慢的机器，长时间【5天】不执行full gc。回忆young gc过程，发现耗时应该是出现在扫描卡表这块。</p>
<p><strong>卡表：</strong></p>
<p>执行young gc的时候，如果有老年代的对象引用年轻代的对象，年轻代的对象不应该被标记清理。然而young gc是不可能是扫描整个old区，这样young gc时间大幅增加。并且old区引用年轻代情况不到1%。于是引入卡表，将old区分成许多大小相等的卡表，如果卡表里有对象引用年轻代对象，卡表标记为脏。下次young gc的时候只用扫描卡表，避免扫描整个old区。</p>
<p>扫描卡表的时间，ali jdk有参数可以打印时间，普通的jdk没有。</p>
<p>长时间不执行full gc，导致状态为脏的卡表越来越多，扫描越来越耗时。</p>
<h4 id="解决："><a href="#解决：" class="headerlink" title="解决："></a>解决：</h4><p>（1）调整Jdk参数，调小old区，调小晋升年龄，适当加大young区，适当增加gc线程【减少young gc次数，提高系统吞吐量】。</p>
<p>（2）每天夜里12点，业务量很小的时候，在服务器起一个定时任务手动执行gc。</p>
<p>2者一起使用。gc参数随着系统的访问量而调整，在上最后一道保险是手动执行gc。</p>
<h4 id="结果："><a href="#结果：" class="headerlink" title="结果："></a>结果：</h4><p> 最终Ygc 时间从4000ms到50ms。</p>
<h3 id="业务升级"><a href="#业务升级" class="headerlink" title="业务升级"></a>业务升级</h3><p>商家中心做了很多事为商家赋能，提高商家的生产力。主要的2项：长链接推送中台服务，合流墙项目。</p>
<h4 id="长链接推送服务"><a href="#长链接推送服务" class="headerlink" title="长链接推送服务"></a>长链接推送服务</h4><h5 id="问题："><a href="#问题：" class="headerlink" title="问题："></a>问题：</h5><p>商家经常抱怨订单来了，他们不知道。自驱开发基于netty长链接的高性能推送中台服务解决漏订单问题。之前的声音提醒是用Ajax 实时轮询查询后端es，门店不管有没有单，都会定时轮讯查询Es，查询条件很复杂，并且是很耗费性能的聚合查询，造成Es集群压力很大，常常影响到其他查询服务。在经过技术调研和预演，最终使用Netty开发出基于websocket协议的长链接推送中台服务。目前长链接服务主要用于Web端的自动打印和声音提醒。具体的过程【拿声音提醒为例】是这样：长链接服务接受Mq【比如订单中心下发商家订单Mq】，向前端发送消息，前端接到消息后播放声音提醒语音，同时回传接收成功消息。如果没有回传，长链接服务器会再次发出消息，直至前端回传成功。这样保证了消息的触达。</p>
<p>效果很好，其他团队也在接入使用。长链接数量上升，在100万左右。单机会出现瓶颈，单点故障等问题。</p>
<p>架构升级：分布式改造中台推送服务遇到的困难：</p>
<p>（1）长链接自动断开。</p>
<p>起初以为是长链接服务代码的问题。经过许多次的测试和发现，发现前端链接长链接服务如果是通过Ip直联的方式不存在断开问题，故排除长链接服务问题。为了实现负载均衡前端通过京东网关链接长链接服务器， 而网关有一个心跳检查机制，每隔5分钟检查客户端和服务端的通讯状态，如果5分钟内没有通讯，则会断开长链接服务。</p>
<p><strong>解决：</strong></p>
<p>​    自写前端js脚本，实现每隔3分钟，向后端发送心跳信息，长链接服务器在应答，这样便实现一次通讯。成功欺骗过京东网关，实现长链接永不断开。并且及时长链接被断开，也实现了断开也会重连。</p>
<p>（2）路由问题。长链接中台服务后端有多台机器，推送的时候是不知道具体建立的长链接通道在那台服务器。</p>
<p>解决：</p>
<p>1、扩展长链接服务，由于使用netty，很容易支持http。方案是A、B任意一台服务器接收到mq消息，向所有的长链接服务器发送http服务，把消息推给所有服务器，最总只会有一台服务器推送成功，其他服务器没有推送通道</p>
<p>2、mq广播</p>
<p>3、引入redis缓存记录路由关系。key：门店编号，value：ip地址列表</p>
<p>4、引入注册中心，每次链接都向注册中心注册，下次接到mq后，从注册中心获取长链接通道所在的机器ip</p>
<p>最终选择1，实现简单，还能对外对接方便，并且内网的http调用开销很小，部署机器3台不多，多2次http而已。</p>
<h4 id="合流墙项目"><a href="#合流墙项目" class="headerlink" title="合流墙项目"></a>合流墙项目</h4><h5 id="问题：-1"><a href="#问题：-1" class="headerlink" title="问题："></a>问题：</h5><p>目前到家对接了全国基本所有的大型超市。比如永辉，沃尔玛等。但是这个大超市有一个特点门店面积很大，达到几万平米。订单时效是1小时，顾客买的东西遍布于几万平米的各个地方，于是如何快速的捡货成为了发展瓶颈。前期设置前置仓解决了大部分问题。前置仓就是超市特定为到家设置200平米的捡货区域，这个区域包含最热门的sku商品。但是这样做提供的服务是有损的，不能买到超市的所有东西，把超市的所有sku都搬到线上去。于是合流墙便产生了。</p>
<p>合流墙项目是我带领3人小团队突击开发在一个月内完成上线的。从0到1搭建了整个项目的架构，并且实现了所有核心流程的代码。</p>
<p>合流墙的思想是：将订单按商品分类拆分成多个捡货单，每个分类安排几个捡货员，这样实现了并行捡货，最后每个捡货任务捡完后合并打包送出。</p>
<p>合流墙上线后大大提高了商家捡货能力，捡货时间由30分钟下降为15分钟左右。让商家原来每天只能生产2000订单，可以攀升到5000单。</p>
<h2 id="整体思考"><a href="#整体思考" class="headerlink" title="整体思考"></a>整体思考</h2><p>订单业务越来越复杂，定制化需求越来越多，代码复杂度越来越高，最终导致难以维护。</p>
<p>目前订单中心对接了线下赋能业务，京东订单中心业务，自提业务。 于是大中台概念</p>
<p>要做的事：</p>
<p>（1）订单中台只负责订单的基本操作【定义订单生产的各个节点：支付完成-&gt; 暂停补全信息-〉下发商家-&gt; 等待出库-&gt;配送中-〉妥投完成。订单状态的变更通知，查询订单基础信息】，并且每个操作都是原子性的，不牵扯任何业务逻辑。单独提供sdk给其他业务系统，各自定制订单的各个流程【比如线下自提订单，订单流程：支付完成-》妥投】。各个流程可以供其他业务随意定义。这样订单中心可以应对各种复杂业务场景，实现自配置。</p>
<p>技术上：</p>
<p>实现高可用，可伸缩，可熔断降级。 rpc框架提供远程调用服务，jmq提供削峰，异步处理，消息通知。</p>
<p>搭建异地多数据中心，实现数据高可用。 搭建es冷热双集群，实现查询服务的高可用。</p>
<p>考虑新技术TiDb，完全兼容mysql协议，不用分库分表【扩容迁移数据问题，多表join问题，聚合查询问题】，可以无限水平扩容。</p>
<p>问问题：</p>
<p>公司对新入职的员工的培养机制是什么样的呢</p>
<p>新人怎么快速融入团队。</p>
<p>核算是一个什么部门，可以介绍下吗，我的理解就是计费？</p>
<p>团队现在面临的最大挑战是什么</p>
<p>针对我的面试表现，你觉得我还有那些地方可以提高？</p>
<p>薪资。3月加薪加7月升值，期望35k，至少32k</p>
<p>看中长远发展，看中大平台。全球领先的平台，服务于几十亿用户，做更有挑战的事。和更优秀的人共事，成长得更快。</p>
<p>缺点：容易紧张。表达能力一般，需要提高。</p>
<p>优点：吃苦耐劳，肯专研，技术有追求。</p>
<p>杭州。北方不习惯。</p>

    </div>

    
    
    

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2018/03/04/Java-%E7%9F%A5%E8%AF%86%E5%A4%A7%E5%85%A8/" rel="next" title="Java 知识大全">
                  <i class="fa fa-chevron-left"></i> Java 知识大全
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/10/20/%E4%B8%BAHexo%E9%85%8D%E7%BD%AEGitalk%EF%BC%8C%E5%B9%B6%E6%9B%B4%E6%94%B9%E4%B8%BB%E9%A2%98%E9%A2%9C%E8%89%B2/" rel="prev" title="为Hexo配置Gitalk，并更改主题颜色">
                  为Hexo配置Gitalk，并更改主题颜色 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#订单中心："><span class="nav-number">1.</span> <span class="nav-text">订单中心：</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简介："><span class="nav-number">1.1.</span> <span class="nav-text">简介：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#现状："><span class="nav-number">1.2.</span> <span class="nav-text">现状：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#技术架构升级优化："><span class="nav-number">1.3.</span> <span class="nav-text">技术架构升级优化：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#业务升级："><span class="nav-number">1.4.</span> <span class="nav-text">业务升级：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#成果："><span class="nav-number">1.4.1.</span> <span class="nav-text">成果：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#背景（why）："><span class="nav-number">1.4.2.</span> <span class="nav-text">背景（why）：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#优化"><span class="nav-number">1.4.3.</span> <span class="nav-text">优化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#后续对配送联盟的下一步思考："><span class="nav-number">1.4.4.</span> <span class="nav-text">后续对配送联盟的下一步思考：</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#商家中心"><span class="nav-number">2.</span> <span class="nav-text">商家中心</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#简介：-1"><span class="nav-number">2.1.</span> <span class="nav-text">简介：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#技术优化："><span class="nav-number">2.2.</span> <span class="nav-text">技术优化：</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#现象："><span class="nav-number">2.2.1.</span> <span class="nav-text">现象：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#分析："><span class="nav-number">2.2.2.</span> <span class="nav-text">分析：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#解决："><span class="nav-number">2.2.3.</span> <span class="nav-text">解决：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#结果："><span class="nav-number">2.2.4.</span> <span class="nav-text">结果：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#业务升级"><span class="nav-number">2.3.</span> <span class="nav-text">业务升级</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#长链接推送服务"><span class="nav-number">2.3.1.</span> <span class="nav-text">长链接推送服务</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#问题："><span class="nav-number">2.3.1.1.</span> <span class="nav-text">问题：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#合流墙项目"><span class="nav-number">2.3.2.</span> <span class="nav-text">合流墙项目</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#问题：-1"><span class="nav-number">2.3.2.1.</span> <span class="nav-text">问题：</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#整体思考"><span class="nav-number">3.</span> <span class="nav-text">整体思考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Ke Xiang"
    src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Ke Xiang</p>
  <div class="site-description" itemprop="description">Do more, Know more, Be more</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/fi-null" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;fi-null" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xk123401@foxmail.com" title="E-Mail &amp;rarr; mailto:xk123401@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/xk123401" title="Weibo &amp;rarr; https:&#x2F;&#x2F;weibo.com&#x2F;xk123401" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://steamcommunity.com/profiles/76561198313695590/" title="Steam &amp;rarr; https:&#x2F;&#x2F;steamcommunity.com&#x2F;profiles&#x2F;76561198313695590&#x2F;" rel="noopener" target="_blank"><i class="fa fa-fw fa-steam"></i>Steam</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  &copy; 2018 – 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ke & Xiang</span>
</div>

        
<div class="busuanzi-count">
  <script pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/pjax/pjax.min.js?v=0.2.8"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.4.1.js"></script>

<script src="/js/motion.js?v=7.4.1.js"></script>


<script src="/js/schemes/pisces.js?v=7.4.1.js"></script>


<script src="/js/next-boot.js?v=7.4.1.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.getAttribute('pjax') !== null) {
      element.setAttribute('pjax', '');
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  
  <script pjax>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>






  
<script src="/js/local-search.js?v=7.4.1.js"></script>













    <div id="pjax">

  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/gh/macyrate/gitalk@2.0.0/dist/gitalk.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/gh/macyrate/gitalk@2.0.0/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'aa2288c6cbb5322cac6b',
      clientSecret: '63492ee584a83a8479f1408f33e2ca04e3ef9f82',
      repo: 'fi-null.github.io',
      owner: 'fi-null',
      admin: ['fi-null'],
      id: '940895bdb33fd8bb3a1b96acb5fe7d37',
        language: 'zh-CN',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

    </div>
</body>
<div id="contentleft">
  <div class="aplayer" 
  data-id="388713953" 
  data-server="netease" 
  data-type="playlist" 
  data-fixed="true" 
  data-autoplay="true" 
  data-order="random" 
  data-volume="0.5" 
  data-theme="#cc543a" 
  date-preload="auto" 
  ></div>
  <meting-js
	server="netease"
	type="playlist"
	id="60198">
</meting-js>
</div>
</html>